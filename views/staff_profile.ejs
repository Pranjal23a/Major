<link rel="stylesheet" type="text/css" href="/css/staff_profile.css">
<% if(locals.user){ %>

    <!-- isko bhi side mai as a list add krio -->
    <a href=" /staff/profile"><button>Update Inventory</button></a>
    <a href=" /staff/search"><button>Search Inventory</button></a>


    <h3>Update Inventory</h3>
    <form action="/inventory/drop" method="POST">
        <input type="text" name="medicine_id" placeholder="Medicine ID" required>
        <input type="number" name="stock" placeholder="Unit Sell" required>
        <input type="submit" value="Update">
    </form>

    <table border="1" style="text-align: center;">
        <thead>
            <th>Medicine ID</th>
            <th>Name</th>
            <th>Stock</th>
            <th>Price(per Unit)</th>
            <th>Expiry Date</th>
        </thead>
        <tbody>
            <% for(info of data){%>
                <tr>
                    <td>
                        <%= info.medicine_id %>
                    </td>
                    <td>
                        <%= info.name%>
                    </td>
                    <td>
                        <%= info.stock %> U
                    </td>
                    <td>
                        Rs. <%= info.price %>
                    </td>
                    <td style="<%=checkExpiration(info.exp_date) %>">
                        <%= new Date(info.exp_date).toLocaleDateString('en-US', { year: 'numeric' , month: 'short' ,
                            day: 'numeric' }) %>
                    </td>
                </tr>
                <% } %>
        </tbody>
    </table>

    <% } %>
        <script>
        <% function checkExpiration(expDate) {
                var currentDate = new Date();
                var expirationDate = new Date(expDate);
                var timeDifference = expirationDate - currentDate;
                var daysUntilExpiration = Math.floor(timeDifference / (1000 * 60 * 60 * 24));

                if (daysUntilExpiration < 0) {
                    return " background-color: red;";
                } else if (daysUntilExpiration <= 30) {
                    return "background-color: orange;";
                } else { return ""; }
            } %>
        </script>