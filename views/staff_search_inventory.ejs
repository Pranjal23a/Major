<% if(locals.user){ %>
    <!-- isko bhi side mai as a list add krio -->
    <a href=" /staff/profile"><button>Update Inventory</button></a>
    <a href=" /staff/search"><button>Search Inventory</button></a>
    <h2>Search Inventory</h2>
    <form id="search-form">
        <input type="text" id="search-query" placeholder="Medicine Name" required>
        <input type="submit" value="Search">
    </form>

    <div id="search-results">
        <table border="1" style="text-align: center;">
            <thead>
                <th>Medicine ID</th>
                <th>Name</th>
                <th>Stock</th>
                <th>Price(per Unit)</th>
                <th>Expiry Date</th>
            </thead>
            <tbody>
                <% for(info of data){%>
                    <tr>
                        <td>
                            <%= info.medicine_id %>
                        </td>
                        <td>
                            <%= info.name%>
                        </td>
                        <td>
                            <%= info.stock %> U
                        </td>
                        <td>
                            Rs. <%= info.price %>
                        </td>
                        <td style="<%=checkExpiration(info.exp_date) %>">
                            <%= new Date(info.exp_date).toLocaleDateString('en-US', { year: 'numeric' , month: 'short' ,
                                day: 'numeric' }) %>
                        </td>
                    </tr>
                    <% } %>
            </tbody>
        </table>
    </div>

    <% } %>
        <script>
       <% function checkExpiration(expDate) {
                var currentDate = new Date();
                var expirationDate = new Date(expDate);
                var timeDifference = expirationDate - currentDate;
                var daysUntilExpiration = Math.floor(timeDifference / (1000 * 60 * 60 * 24));

                if (daysUntilExpiration < 0) {
                    return " background-color: red;";
                } else if (daysUntilExpiration <= 30) {
                    return "background-color: orange;";
                } else {
                    return "";
                }
            }
                %>
        </script>
        <script src="/js/search.js"></script>